<ng-template #option>
  <ng-content></ng-content>
</ng-template>
<div
  cdk-overlay-origin
  (click)="toggle($event)"
  #origin="cdkOverlayOrigin"
  #trigger
  class="form-control form-control-custom"
  [class.disabled]="_disabled"
  [class.thy-select-selection]="!_mode"
  [ngClass]="_size ? 'form-control-' + _size : ''"
>
  <ng-container *ngIf="_mode !== 'multiple'; else multiple">
    <ng-container *ngIf="selectionModel?.selected.length > 0; else placeHolderTmpl">
      <ng-container *ngIf="selectedValueDisplayRef">
        <ng-container *ngTemplateOutlet="selectedValueDisplayRef; context: selectedDisplayContext"></ng-container>
      </ng-container>
      <ng-container *ngIf="!selectedValueDisplayRef && selectionModel">
        <span>{{ (selectionModel?.selected)[0].thyLabelText }}</span>
      </ng-container>
      <a
        class="thy-select-remove remove-link"
        href="javascript:;"
        (click)="clearSelectValue($event)"
        *ngIf="thyAllowClear"
      >
        <i class="wtf wtf-times-circle"></i>
      </a>
    </ng-container>
  </ng-container>
  <ng-template #multiple>
    <div [ngClass]="{ 'multiple-value-wrapper': _selectedOptions?.length > 0 }">
      <ng-container *ngIf="selectionModel?.selected.length > 0; else placeHolderTmpl">
        <span
          class="mr-1"
          *ngFor="let item of selectionModel.selected; index as i"
          thyLabel="default"
          thyAfterIcon="wtf-times"
          (click)="remove($event, item, i)"
        >
          {{ item.thyLabelText }}
        </span>
      </ng-container>
    </div>
  </ng-template>
  <ng-template #placeHolderTmpl>
    <span class="text-placeholder d-inline-block">
      {{ thyPlaceHolder }}
    </span>
  </ng-template>
</div>

<ng-template
  cdk-connected-overlay
  cdkConnectedOverlayLockPosition
  cdkConnectedOverlayHasBackdrop
  [cdkConnectedOverlayPositions]="positions"
  cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
  [cdkConnectedOverlayOrigin]="origin"
  [cdkConnectedOverlayOpen]="_expandOptions"
  [cdkConnectedOverlayMinWidth]="triggerRect?.width"
  (backdropClick)="close()"
  (detach)="close()"
>
  <div class="thy-select-container">
    <div class="thy-select-search" *ngIf="thyShowSearch">
      <thy-input-search
        thyAutofocus
        name="search"
        [(ngModel)]="searchText"
        (ngModelChange)="onSearchFilter()"
      ></thy-input-search>
    </div>
    <ng-container *ngIf="options.length > 0 || optionGroups.length > 0; else emptyPlaceholder">
      <div class="thy-select-custom-options">
        <ng-content></ng-content>
      </div>
    </ng-container>
    <ng-template #emptyPlaceholder>
      <div class="pl-4 pt-1 pb-1 text-placeholder">{{ _emptyStateText }}</div>
    </ng-template>
  </div>
</ng-template>
