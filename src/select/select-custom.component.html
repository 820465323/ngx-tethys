<ng-template #option>
  <ng-content></ng-content>
</ng-template>
<div
  cdk-overlay-origin
  (click)="toggle($event)"
  #origin="cdkOverlayOrigin"
  #trigger
  class="form-control form-control-custom"
  [class.disabled]="_disabled"
  [class.thy-select-selection]="!_mode"
  [ngClass]="_size ? 'form-control-' + _size : ''"
>
  <ng-container *ngIf="!_mode">
    <span *ngIf="_selectedOption && !selectedValueDisplayRef">{{ _selectedOption.thyLabelText }}</span>
    <ng-container *ngIf="_selectedOption && selectedValueDisplayRef">
      <ng-container *ngTemplateOutlet="selectedValueDisplayRef; context: selectedValueContext"></ng-container>
    </ng-container>
    <span class="text-placeholder d-inline-block" *ngIf="!_selectedOption">{{ thyPlaceHolder }}</span>
    <a
      class="thy-select-remove remove-link"
      href="javascript:;"
      (click)="clearSelectValue($event)"
      *ngIf="thyAllowClear && _innerValue"
    >
      <i class="wtf wtf-times-circle"></i>
    </a>
  </ng-container>
  <div [ngClass]="{ 'multiple-value-wrapper': _selectedOptions?.length > 0 }" *ngIf="_mode === 'multiple'">
    <span
      class="mr-1"
      [hidden]="_selectedOptions?.length === 0"
      *ngFor="let item of _selectedOptions; index as i"
      thyLabel="default"
      thyAfterIcon="wtf-times"
      (click)="remove($event, item, i)"
    >
      {{ item?.thyLabelText }}
    </span>
    <span class="text-placeholder d-inline-block" *ngIf="_selectedOptions?.length === 0">
      {{ thyPlaceHolder }}
    </span>
  </div>
</div>

<ng-template
  cdk-connected-overlay
  cdkConnectedOverlayHasBackdrop
  [cdkConnectedOverlayPositions]="positions"
  (positionChange)="onPositionChange($event)"
  cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
  [cdkConnectedOverlayOrigin]="origin"
  [cdkConnectedOverlayOpen]="_expandOptions"
  [cdkConnectedOverlayMinWidth]="triggerRect?.width"
  (backdropClick)="close()"
  (detach)="close()"
>
  <div class="thy-select-container">
    <div class="thy-select-search" *ngIf="thyShowSearch">
      <thy-input-search
        thyAutofocus
        name="search"
        [(ngModel)]="searchText"
        (ngModelChange)="onSearchFilter()"
      ></thy-input-search>
    </div>
    <ng-container *ngIf="options.length > 0 || optionGroups.length > 0; else emptyPlaceholder">
      <div class="thy-select-custom-options">
        <ng-content></ng-content>
      </div>
    </ng-container>
    <ng-template #emptyPlaceholder>
      <div class="pl-4 pt-1 pb-1 text-placeholder">{{ _emptyStateText }}</div>
    </ng-template>
  </div>
</ng-template>
